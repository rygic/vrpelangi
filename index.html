<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelangi VR - Sidoarjo 360¬∞</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            background: #000;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        #status {
            margin-top: 20px;
            text-align: center;
        }
        
        #error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            z-index: 10001;
            display: none;
            border: 2px solid red;
        }
        
        .test-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <h2>Pelangi VR - GitHub Pages</h2>
        <div id="status">Loading A-Frame...</div>
    </div>

    <!-- Error Message -->
    <div id="error">
        <h3>Video Loading Issue</h3>
        <p id="error-message"></p>
        <button class="test-btn" onclick="testBasicScene()">Test Basic 3D Scene</button>
        <button class="test-btn" onclick="testDifferentVideo()">Try Different Video</button>
    </div>

    <!-- A-Frame Scene -->
    <a-scene vr-mode-ui="enabled: true">
        <a-assets>
            <!-- Video dengan multiple fallbacks -->
            <video id="video1" autoplay loop muted playsinline crossorigin="anonymous">
                <source src="https://cdn.aframe.io/360-video-boilerplate/video-360.mp4" type="video/mp4">
            </video>
        </a-assets>

        <!-- Video Sphere -->
        <a-videosphere src="#video1" rotation="0 -90 0"></a-videosphere>

        <!-- Camera -->
        <a-entity camera look-controls wasd-controls position="0 1.6 0">
            <a-cursor></a-cursor>
        </a-entity>

        <!-- Basic Lighting -->
        <a-light type="ambient" color="#444"></a-light>
        <a-light type="directional" color="#fff" intensity="0.8" position="0 1 1"></a-light>
    </a-scene>

    <script>
        // Debug information
        console.log('üîß GitHub Pages VR Debug');
        console.log('User Agent:', navigator.userAgent);
        console.log('Online:', navigator.onLine);
        
        const status = document.getElementById('status');
        const loading = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const errorMsg = document.getElementById('error-message');

        // Wait for A-Frame to initialize
        window.addEventListener('load', function() {
            console.log('‚úÖ Page fully loaded');
            status.textContent = 'A-Frame loaded, initializing video...';
            
            // Check if A-Frame is properly loaded
            if (typeof AFRAME === 'undefined') {
                showError('A-Frame failed to load. Check internet connection.');
                return;
            }
            
            initializeVideo();
        });

        function initializeVideo() {
            const video = document.getElementById('video1');
            
            if (!video) {
                showError('Video element not found');
                return;
            }

            // Video event listeners
            video.addEventListener('loadstart', () => {
                console.log('üì• Video load started');
                status.textContent = 'Loading video...';
            });

            video.addEventListener('loadeddata', () => {
                console.log('‚úÖ Video data loaded');
                console.log('Video dimensions:', video.videoWidth + 'x' + video.videoHeight);
                status.textContent = 'Video loaded!';
            });

            video.addEventListener('canplay', () => {
                console.log('üéØ Video can play');
                status.textContent = 'Starting playback...';
            });

            video.addEventListener('playing', () => {
                console.log('‚ñ∂Ô∏è Video playing successfully!');
                status.textContent = 'VR Experience Ready!';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 1000);
            });

            video.addEventListener('error', (e) => {
                console.error('‚ùå Video error:', e);
                console.error('Video error code:', video.error);
                showError('Video failed to load: ' + (video.error ? video.error.message : 'Unknown error'));
            });

            // Try to play the video
            setTimeout(() => {
                console.log('üé¨ Attempting to play video...');
                video.play().catch(error => {
                    console.log('‚ö†Ô∏è Play failed:', error);
                    // This is normal for autoplay restrictions
                });
            }, 1000);

            // Check video status after 3 seconds
            setTimeout(() => {
                checkVideoStatus();
            }, 3000);
        }

        function checkVideoStatus() {
            const video = document.getElementById('video1');
            
            if (!video) {
                showError('Video element missing');
                return;
            }

            console.log('üîç Video Status Check:');
            console.log('- Ready State:', getReadyState(video.readyState));
            console.log('- Network State:', getNetworkState(video.networkState));
            console.log('- Video Dimensions:', video.videoWidth + 'x' + video.videoHeight);
            console.log('- Paused:', video.paused);
            console.log('- Ended:', video.ended);
            console.log('- Error:', video.error);

            // If video has no dimensions after loading, it's likely a black screen issue
            if (video.readyState >= 2 && video.videoWidth === 0 && video.videoHeight === 0) {
                showError('Video loaded but has 0 dimensions. Format may be incompatible.');
            }

            // If still loading after 5 seconds, show options
            if (video.readyState < 3) {
                status.textContent = 'Taking longer than expected...';
            }
        }

        function getReadyState(state) {
            const states = ['HAVE_NOTHING', 'HAVE_METADATA', 'HAVE_CURRENT_DATA', 'HAVE_FUTURE_DATA', 'HAVE_ENOUGH_DATA'];
            return states[state] || state;
        }

        function getNetworkState(state) {
            const states = ['NETWORK_EMPTY', 'NETWORK_IDLE', 'NETWORK_LOADING', 'NETWORK_NO_SOURCE'];
            return states[state] || state;
        }

        function showError(message) {
            errorMsg.textContent = message;
            errorDiv.style.display = 'block';
            status.textContent = 'Error occurred';
        }

        function testBasicScene() {
            // Switch to a basic 3D scene without video
            const scene = document.querySelector('a-scene');
            scene.innerHTML = `
                <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
                <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
                <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
                <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
                <a-sky color="#ECECEC"></a-sky>
                <a-entity camera look-controls position="0 1.6 0">
                    <a-cursor></a-cursor>
                </a-entity>
            `;
            loading.style.display = 'none';
            errorDiv.style.display = 'none';
        }

        function testDifferentVideo() {
            // Try a different video source
            const video = document.getElementById('video1');
            video.src = 'https://assets.codepen.io/1480814/360vid1.mp4';
            video.load();
            errorDiv.style.display = 'none';
            status.textContent = 'Trying alternative video...';
        }

        // Global click handler to help with autoplay
        document.addEventListener('click', function() {
            const video = document.getElementById('video1');
            if (video && video.paused) {
                video.play().catch(e => {
                    console.log('Manual play failed:', e);
                });
            }
        });

        // Fallback: hide loading after 8 seconds
        setTimeout(() => {
            if (loading.style.display !== 'none') {
                console.log('‚è∞ Fallback: Hiding loading screen');
                loading.style.display = 'none';
            }
        }, 8000);
    </script>
</body>
</html>
